#========================================
# Shell
#========================================
set -g default-shell /opt/homebrew/bin/zsh

#========================================
# General
#========================================
set -g default-terminal "screen-256color"
set -g escape-time 0
set -g mouse on
set -g clock-mode-colour cyan
## コピーモード時(Prefix + [)にviのキーバインドを使用する
set -g mode-keys vi

#========================================
# Key-bindings
#========================================
unbind C-b
set -g prefix C-a
unbind &
bind -N 'Kill current window' x kill-pane
bind -N 'Create a new window with current path' -T prefix c new-window -a -c '#{pane_current_path}'
bind -N 'Split the window horizontally' % split-window -h -c '#{pane_current_path}'
bind -N 'Split the window vertically' '"' split-window -v -c '#{pane_current_path}'
bind -N 'Open lazygit in a popup window' -n C-l popup -w80% -h80% -d '#{pane_current_path}' -E 'lazygit'
bind -N '一時的に全画面表示' -n M-z resize-pane -Z
unbind w
bind -N 'Open worktree switcher in a popup window' w popup -w80% -h80% -d '#{pane_current_path}' -E 'zsh -c "source $ZDOTDIR/.zshrc && ${XDG_CONFIG_HOME:-$HOME/.config}/tmux/scripts/worktree-switcher.sh"'
unbind f
bind -N 'Open file manager in a new window' f new-window -a -c '#{pane_current_path}' 'yazi'
unbind m
bind -N 'Open btop in a popup window' m popup -w80% -h80% -E 'btop'
## M-f をプレフィックスとしたキーテーブル
bind -N 'Enter project-table (M-f + p: ghq project switcher)' -n M-f switch-client -T project-table
bind -N 'Open ghq project switcher in a popup window' -T project-table p popup -w80% -h80% -E 'zsh -c "source $ZDOTDIR/.zshrc && ${XDG_CONFIG_HOME:-$HOME/.config}/tmux/scripts/ghq-project-switcher.sh"'
## Copy mode
bind -N 'Move to previous prompt' -T copy-mode-vi [ send-keys -X previous-prompt -o
bind -N 'Move to next prompt' -T copy-mode-vi ] send-keys -X next-prompt -o
bind -N 'Begin selection in copy mode' -T copy-mode-vi v send-keys -X begin-selection
bind -N 'Select line in copy mode' -T copy-mode-vi V send-keys -X select-line
bind -N 'Toggle rectangle selection in copy mode' -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -N 'Yank selection to clipboard' -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -N 'Copy selection to clipboard and cancel' -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

#========================================
# Status Line
#========================================
## 表示位置
set -g status-position bottom
## Color
set -g status-style fg=default,bg=colour234
## コマンドラインの色
set -g message-style fg=colour15,bg=colour234

## status-left
set -g status-left-length 40
set -g status-left '#[fg=colour2]Session:#S #[fg=colour3]Window:#I #[fg=colour4]Pane:#P'

## window-status
set -g status-justify centre
set -gw window-status-format "#[fg=colour4,dim] #{?window_zoomed_flag,\uf002 ,}#I:#W "
### アクティブなウィンドウリストを目立たせる(prefix時は背景色変更)
set -g window-status-current-format "#[fg=colour0,bg=colour2]#{?client_prefix,#[bg=colour4],} #{?window_zoomed_flag,\uf002 ,}#I:#W "
set -g window-status-separator '|'

## status-right
set -g status-right-length 60
set -g status-right '#[fg=colour4,bold][%Y-%m-%d(%a) %H:%M]'

## Visual Notificationを有効にする
set -g monitor-activity on
set -g visual-activity on
## リフレッシュの間隔を設定(リアルタイムな活動検知)
set -g status-interval 1

#========================================
# Window
#========================================
set -g renumber-windows on
set -g base-index 1
set -g pane-base-index 1

## Color
set -g window-style bg=default
set -g window-active-style bg=default
## ペインボーダーの色を設定する
set -g pane-border-style fg=colour4,bg=default
set -g pane-active-border-style fg=colour4,bg=default

#========================================
# Environment Variables
#========================================
set-environment -g FZF_TMUX 1
set-environment -g FZF_TMUX_OPTS '-p 80%'
## tmux-fzf: iceberg theme + reverse layout
set-environment -g TMUX_FZF_OPTIONS "-p -w 80% -h 80% -m --reverse --color=fg:#c6c8d1,bg:#161821,fg+:#d2d4de,bg+:#1e2132 --color=hl:#e27878,hl+:#e27878,info:#6b7089,prompt:#84a0c6 --color=pointer:#89b8c2,marker:#b4be82,spinner:#a093c7,header:#e2a478 --color=border:#6b7089,gutter:#161821"

#========================================
# Plugins
# @ref https://github.com/tmux-plugins/list
#========================================
run 'tmux set-environment -g TMUX_PLUGIN_MANAGER_PATH "${XDG_CONFIG_HOME:-$HOME/.config}/tmux/plugins"'
set -g @plugin 'tmux-plugins/tpm'
## 最低限の安全なデフォルト設定
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

run '${XDG_CONFIG_HOME:-$HOME/.config}/tmux/plugins/tpm/tpm'
